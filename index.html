<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rowe Casa Organics Email Signature Builder</title>

<style>
  :root{
    --bg:#d7d1ca;
    --card:#ffffff;
    --ink:#25282a;
    --muted:#5f4b3c;
    --line:#d6d1c3;
    --soft:#f6f4f1;

    --danger:#b00020;
    --dangerSoft:#fff0f2;

    --ok:#0a7a2f;
    --okHover:#086724;

    --warn:#9a5a00;

    --brandRed:#b00020;
    --brandRedHover:#8f001a;

    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  /* Readability bump */
  body{ margin:16px; background:var(--bg); color:var(--ink); font-size:16px; }
  .wrap{ max-width:1100px; margin:0 auto; }

  header{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:12px;
  }
  .titleRow{ display:flex; align-items:center; gap:12px; flex:1 1 auto; min-width:280px; }
  .titleRow img{ width:36px; height:36px; border-radius:10px; background:var(--card); padding:6px; border:1px solid var(--line); }
  h1{ margin:0; font-size:22px; letter-spacing:.2px; }
  .sub{ margin:6px 0 0; color:#3b3f44; font-size:14px; line-height:1.45; }

  .headerActions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

  .helpBtn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid var(--brandRed);
    background:var(--brandRed);
    color:#fff;
    font-weight:900;
    cursor:pointer;
    white-space:nowrap;
    box-shadow:0 10px 20px rgba(176,0,32,.18);
    transition: all 0.2s ease;
  }
  .helpBtn:hover{ background:var(--brandRedHover); border-color:var(--brandRedHover); }
  .helpBtn:active{ transform:translateY(1px); }
  .helpBtn .dot{
    width:8px; height:8px; border-radius:999px; background:#fff; opacity:.9;
    box-shadow:0 0 0 3px rgba(255,255,255,.18);
  }

  .adminTopBtn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid #bdb4ab;
    background:#fbfaf8;
    color:#1f2326;
    font-weight:900;
    cursor:pointer;
    white-space:nowrap;
    transition: all 0.2s ease;
  }
  .adminTopBtn:hover{ background:#fff; }
  .adminTopBtn:active{ transform:translateY(1px); }

  .grid{ display:grid; grid-template-columns:440px 1fr; gap:14px; align-items:start; }
  @media (max-width:900px){ .grid{ grid-template-columns:1fr; } }

  .card{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:16px;
    padding:16px;
    box-shadow:0 10px 24px rgba(0,0,0,.06);
  }

  .sectionTitle{ display:flex; align-items:baseline; justify-content:space-between; gap:10px; flex-wrap:wrap; margin:0 0 10px; }
  .sectionTitle h2{ margin:0; font-size:20px; letter-spacing:.2px; }
  .sectionHelp{ margin:0; font-size:14px; color:#51565c; line-height:1.45; }
  .sectionHelp b{ color:#1f2326; }

  .divider{ height:1px; background:var(--line); margin:14px 0; }
  .hint{ margin-top:8px; font-size:13px; color:#51565c; line-height:1.4; }

  label{ display:block; font-size:13px; margin:10px 0 6px; color:#1f2326; }
  .req::after{ content:" *"; color:var(--danger); font-weight:900; }

  input{
    width:100%;
    padding:11px;
    border:1px solid #cfc9c2;
    border-radius:12px;
    font-size:16px;
    box-sizing:border-box;
    background:var(--soft);
    outline:none;
    transition: border-color 0.2s, background 0.2s;
  }
  input:focus{ border-color:#a99f96; box-shadow:0 0 0 3px rgba(95,75,60,.10); background:#fff; }
  input.invalid{ border-color:var(--danger); background:var(--dangerSoft); box-shadow:none; }

  .phoneGroup { display:flex; gap:8px; align-items:stretch; }
  .phoneGroup input:first-child { flex:1; }
  .phoneGroup input:last-child { width:130px; }

  .btnRow{ display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; align-items:center; }
  button{
    padding:10px 14px;
    border-radius:12px;
    border:1px solid #c9c2bb;
    background:#f3f1ee;
    font-weight:900;
    cursor:pointer;
    color:var(--ink);
    transition: all 0.2s ease;
  }
  /* Green primary buttons */
  button.primary{
    background:var(--ok);
    color:#fff;
    border-color:var(--ok);
    box-shadow:0 10px 20px rgba(10,122,47,.18);
  }
  button.primary:hover{ background:var(--okHover); border-color:var(--okHover); }
  button:disabled{ opacity:.55; cursor:not-allowed; box-shadow:none; }
  button:active{ transform:translateY(1px); }

  @keyframes flashSuccess {
    0% { background-color: var(--ok); border-color: var(--ok); color: white; transform: scale(1.03); }
    100% { transform: scale(1); }
  }
  button.copied { animation: flashSuccess 0.4s ease-out; }

  .status{ margin-top:10px; font-size:13px; line-height:1.4; min-height:34px; }
  .status .ok{ color:var(--ok); font-weight:900; }
  .status .warn{ color:var(--warn); font-weight:900; }
  .status .err{ color:var(--danger); font-weight:900; }

  .callout{
    margin-top:12px;
    padding:12px 14px;
    border-radius:14px;
    border:1px solid rgba(176,0,32,.25);
    background:rgba(176,0,32,.05);
    color:#1f2326;
    font-size:14px;
    line-height:1.4;
  }
  .callout b{ color:var(--danger); }

  /* App selector (checkbox tiles) */
  .appGrid{
    display:grid;
    grid-template-columns:1fr;
    gap:10px;
    margin-top:10px;
  }
  .appOpt{
    display:flex;
    gap:12px;
    align-items:flex-start;
    padding:12px 12px;
    border-radius:16px;
    border:1px solid var(--line);
    background:#fff;
    cursor:pointer;
    user-select:none;
  }
  .appOpt:hover{ background:#fbfaf8; }
  .appOpt input{ width:auto; padding:0; margin-top:3px; transform:scale(1.15); }
  .appOptTitle{ margin:0; font-weight:900; font-size:16px; color:#1f2326; line-height:1.2; }
  .appOptDesc{ margin:0; font-size:13px; color:#51565c; line-height:1.2; }
  .appOptRow{ display:flex; gap:10px; align-items:center; justify-content:space-between; width:100%; }
  .pill{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding:4px 10px;
    border-radius:999px;
    border:1px solid var(--line);
    background:#fbfaf8;
    font-size:12px;
    color:#2a2e32;
    font-weight:900;
    white-space:nowrap;
  }

  /* Signature preview */
  .previewWrap{
    padding:12px;
    border:1px dashed #bdb4ab;
    border-radius:14px;
    background:#fbfaf8;
    overflow-x:auto;
  }

  /* Instructions */
  .instGrid{
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
    margin-top:12px;
  }
  .instCard{
    border:1px solid var(--line);
    border-radius:16px;
    background:#fff;
    padding:14px;
  }
  .instHead{
    display:flex;
    align-items:flex-start;
    gap:12px;
  }
  .instNum{
    width:34px;
    height:34px;
    border-radius:999px;
    border:2px solid #cfc9c2;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:900;
    color:#1f2326;
    flex:0 0 auto;
    margin-top:1px;
    background:#fbfaf8;
  }
  .instCard h3{ margin:0 0 6px; font-size:18px; letter-spacing:.2px; }
  .instCard p{ margin:6px 0; font-size:15px; color:#2a2e32; line-height:1.45; }
  .instCard ul{ margin:10px 0 0 20px; padding:0; }
  .instCard li{ margin:8px 0; color:#1f2326; font-size:15px; line-height:1.4; }

  /* Screenshot accordion (bigger, clickable) */
  details.shots{
    margin-top:12px;
    border:1px solid var(--line);
    background:#fbfaf8;
    border-radius:16px;
    padding:10px 12px;
  }
  summary.shotsSum{
    cursor:pointer;
    font-weight:900;
    color:#1f2326;
    list-style:none;
    outline:none;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  summary.shotsSum::-webkit-details-marker{ display:none; }
  .shotsTitle{
    display:flex; align-items:center; gap:10px;
    font-size:16px;
  }
  .shotIcon{
    width:34px; height:34px; border-radius:12px;
    display:flex; align-items:center; justify-content:center;
    border:1px solid var(--line);
    background:#fff;
    flex:0 0 auto;
  }
  .shotCaret{
    width:44px; height:44px;
    border-radius:14px;
    border:1px solid var(--line);
    background:#fff;
    display:flex; align-items:center; justify-content:center;
    font-weight:900;
    transition: transform .18s ease;
  }
  details[open] .shotCaret{ transform: rotate(180deg); }

  .shotsBody{ margin-top:12px; }
  .shotGrid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
  }
  @media (max-width:820px){
    .shotGrid{ grid-template-columns:1fr; }
  }
  .shotThumb{
    border:1px solid var(--line);
    border-radius:16px;
    background:#fff;
    overflow:hidden;
    cursor:pointer;
  }
  .shotThumb img{
    width:100%;
    height:auto;
    display:block;
  }
  .shotCap{
    padding:10px 12px;
    font-size:13px;
    color:#3b3f44;
    border-top:1px solid var(--line);
    background:#fbfaf8;
  }

  /* Admin panel (hidden until password) */
  .adminPanel{ display:none; margin-top:14px; }
  .adminPanel.show{ display:block; }

  details.adminAcc{
    border:1px solid var(--line);
    background:#fbfaf8;
    border-radius:16px;
    padding:10px 12px;
    margin-top:10px;
  }
  summary.adminSum{
    cursor:pointer;
    font-weight:900;
    color:#1f2326;
    list-style:none;
    outline:none;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    font-size:16px;
  }
  summary.adminSum::-webkit-details-marker{ display:none; }
  .caret{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    width:38px;
    height:38px;
    border-radius:14px;
    border:1px solid var(--line);
    background:#fff;
    color:#1f2326;
    font-weight:900;
    line-height:1;
    flex:0 0 auto;
    transform: rotate(180deg);
    transition: transform .18s ease;
  }
  details[open] .caret{ transform: rotate(0deg); }

  textarea{
    width:100%;
    min-height:220px;
    padding:10px;
    border:1px solid #cfc9c2;
    border-radius:12px;
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    font-size:12px;
    box-sizing:border-box;
    background:#fff;
    outline:none;
    white-space:pre;
  }

  /* Modals */
  .modalBackdrop{
    position:fixed; inset:0;
    background:rgba(37,40,42,.55);
    display:none;
    align-items:center;
    justify-content:center;
    padding:14px;
    z-index:9999;
    backdrop-filter: blur(2px);
  }
  .modal{
    width:min(980px, 100%);
    background:#fff;
    border-radius:18px;
    border:1px solid var(--line);
    padding:14px;
    box-shadow:0 18px 60px rgba(0,0,0,.22);
  }
  .modalTopRow{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:10px;
  }
  .modal h2{ margin:0; font-size:18px; }
  .modalCloseTop{
    padding:10px 14px;
    border-radius:12px;
    border:1px solid #c9c2bb;
    background:#f3f1ee;
    font-weight:900;
    cursor:pointer;
  }

  .tabs{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin:10px 0 12px;
  }
  .tabBtn{
    padding:10px 14px;
    border-radius:999px;
    border:2px solid #cfc9c2;
    background:#fbfaf8;
    font-weight:900;
    cursor:pointer;
    color:#1f2326;
  }
  .tabBtn.active{
    border-color:#1f2326;
    background:#1f2326;
    color:#fff;
  }

  .helpPanel{
    border:1px solid var(--line);
    background:#fbfaf8;
    border-radius:16px;
    padding:14px;
  }
  .helpPanel h3{ margin:0 0 8px; font-size:16px; }
  .helpPanel ul{ margin:10px 0 0 20px; padding:0; }
  .helpPanel li{ margin:10px 0; font-size:15px; line-height:1.4; color:#1f2326; }
  .helpPanel p{ margin:10px 0; font-size:15px; line-height:1.45; color:#2a2e32; }

  .importantBox{
    margin:10px 0 14px;
    padding:12px 14px;
    border-radius:16px;
    border:1px solid rgba(176,0,32,.25);
    background:rgba(176,0,32,.05);
    color:#1f2326;
    font-size:15px;
    line-height:1.4;
  }
  .importantBox b{ color:var(--danger); }

  .closeRow{
    display:flex;
    justify-content:space-between;
    gap:8px;
    margin-top:12px;
    align-items:center;
    flex-wrap:wrap;
  }
  .kbd{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    background:#f3f1ee;
    padding:2px 6px;
    border-radius:7px;
    border:1px solid var(--line);
    font-size:13px;
  }

  /* Image preview modal */
  .imgModal{
    width:min(1100px, 100%);
    background:#fff;
    border-radius:18px;
    border:1px solid var(--line);
    padding:14px;
    box-shadow:0 18px 60px rgba(0,0,0,.22);
  }
  .imgWrap{
    border:1px solid var(--line);
    border-radius:16px;
    overflow:hidden;
    background:#000;
  }
  .imgWrap img{
    display:block;
    width:100%;
    height:auto;
    max-height:75vh;
    object-fit:contain;
    background:#000;
  }
</style>
</head>

<body>
<div class="wrap">
  <header>
    <div class="titleRow">
      <img id="uiLogo" alt="Rowe Casa Organics" />
      <div>
        <h1>Rowe Casa Organics Email Signature Builder</h1>
        <p class="sub">Step 1 ‚Üí Build ‚Üí Step 3. Follow each app you select.</p>
      </div>
    </div>

    <div class="headerActions">
      <button class="adminTopBtn" id="btnAdminTop" type="button" aria-label="Admin">Admin</button>
      <button class="helpBtn" id="btnHelpTop" type="button" aria-label="Help / How-To">
        <span class="dot"></span>
        Help / How-To
      </button>
    </div>
  </header>

  <div class="grid">
    <!-- STEP 1 -->
    <section class="card" id="step1">
      <div class="sectionTitle"><h2>Step 1. Setup your Signature.</h2></div>
      <p class="sectionHelp">
        Choose where you use work email, enter your details, then click <b>Build Signature</b>.
      </p>

      <div class="appGrid" aria-label="Choose where you use work email">
        <label class="appOpt">
          <input type="checkbox" id="app_gmail_web" value="gmail_web" />
          <div class="appOptRow">
            <p class="appOptTitle">Gmail (Web)</p>
            <span class="pill">Computer</span>
          </div>
        </label>

        <label class="appOpt">
          <input type="checkbox" id="app_outlook_desktop" value="outlook_desktop" />
          <div class="appOptRow">
            <p class="appOptTitle">Outlook (Desktop)</p>
            <span class="pill">Computer</span>
          </div>
        </label>

        <label class="appOpt">
          <input type="checkbox" id="app_gmail_mobile" value="gmail_mobile" />
          <div class="appOptRow">
            <div>
              <p class="appOptTitle">Gmail (Mobile App)</p>
              <p class="appOptDesc">Quick settings change only.</p>
            </div>
            <span class="pill">Phone</span>
          </div>
        </label>

        <label class="appOpt">
          <input type="checkbox" id="app_outlook_mobile" value="outlook_mobile" />
          <div class="appOptRow">
            <p class="appOptTitle">Outlook (Mobile App)</p>
            <span class="pill">Phone</span>
          </div>
        </label>
      </div>

      <div class="divider"></div>

      <label class="req" for="fullName">Full Name</label>
      <input id="fullName" placeholder="First Last" autocomplete="name" />

      <label class="req" for="jobTitle">Job Title</label>
      <input id="jobTitle" placeholder="Job Title" />

      <label class="req" for="email">Work Email</label>
      <input id="email" placeholder="first.last@rowecasaorganics.com" autocomplete="email" inputmode="email" />

      <label for="cell">Cell Phone (optional)</label>
      <input id="cell" placeholder="555-555-5555" inputmode="tel" />

      <label for="phone" style="margin-top:12px;">Office Phone (optional)</label>
      <div class="phoneGroup">
        <input id="phone" placeholder="555-555-5555" inputmode="tel" />
        <input id="ext" placeholder="Ext (1‚Äì4)" inputmode="numeric" maxlength="4" />
      </div>
      <div class="hint" style="margin-top:6px;">Extension: <b>Numbers only please.</b></div>

      <div class="btnRow">
        <button id="btnReset" type="button">Reset</button>
        <button id="btnGenerate" class="primary" type="button">Build Signature</button>
      </div>

      <div id="status" class="status"></div>
    </section>

    <!-- RIGHT -->
    <section class="card" id="step23">
      <div class="sectionTitle"><h2>Step 2. Copy your signature.</h2></div>
      <p class="sectionHelp">Click <b>Copy Signature</b>, then paste it where the app asks for a signature.</p>

      <div class="previewWrap" id="previewArea"></div>

      <div class="btnRow" style="margin-top:12px;">
        <button id="btnCopySignature" class="primary" type="button" disabled>Copy Signature</button>
      </div>

      <!-- NOTE: intentionally no divider under the Copy button -->

      <div style="height:16px;"></div>

      <div class="sectionTitle"><h2 style="margin:0;">Step 3. Now, add your signature and adjust settings.</h2></div>
      <p class="sectionHelp">Complete all steps for the app(s) selected in Step 1.</p>

      <div class="callout">
        <b>IMPORTANT:</b> Delete any old signature everywhere you use your Rowe Casa Organics email before completing the steps below.
      </div>

      <div class="instGrid" id="instWrap"></div>

      <!-- Admin panel -->
      <div id="adminPanel" class="adminPanel">
        <div class="divider"></div>
        <div class="sectionTitle"><h2 style="font-size:18px;">Admin</h2></div>
        <p class="sectionHelp">IT use only.</p>

        <details class="adminAcc" id="plainTextDetails">
          <summary class="adminSum">
            <span>Plain Text</span>
            <span class="caret" aria-hidden="true">^</span>
          </summary>
          <div style="margin-top:10px;">
            <textarea id="plainOut" spellcheck="false" placeholder="Click Build Signature first to create plain text."></textarea>
            <div class="btnRow" style="margin-top:10px;">
              <button id="btnCopyText" type="button" disabled>Copy Plain Text</button>
            </div>
          </div>
        </details>

        <details class="adminAcc" id="htmlDetails">
          <summary class="adminSum">
            <span>HTML</span>
            <span class="caret" aria-hidden="true">^</span>
          </summary>
          <div style="margin-top:10px;">
            <textarea id="htmlOut" spellcheck="false" placeholder="Click Build Signature first to create HTML."></textarea>
            <div class="btnRow" style="margin-top:10px;">
              <button id="btnCopyHtml" type="button" disabled>Copy HTML</button>
              <button id="btnSave" type="button" disabled>Save to File</button>
            </div>
          </div>
        </details>
      </div>

      <div class="divider"></div>

      <div class="callout">
        <b>Need help?</b> Email IT at
        <a href="mailto:itsupport@rowecasaorganics.com" style="color:var(--brandRed); font-weight:900; text-decoration:none;">itsupport@rowecasaorganics.com</a>.
        Include the app, device, and screenshots of your signature settings + what you pasted.
      </div>
    </section>
  </div>
</div>

<!-- HELP MODAL -->
<div class="modalBackdrop" id="helpBackdrop" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
  <div class="modal">
    <div class="modalTopRow">
      <h2 id="helpTitle">Help ‚Äì Rowe Casa Organics Email Signature</h2>
      <button class="modalCloseTop" id="btnCloseHelpTop" type="button">Close</button>
    </div>

    <div class="tabs" role="tablist" aria-label="Help tabs">
      <button class="tabBtn active" data-tab="general" type="button">General</button>
      <button class="tabBtn" data-tab="gmail_web" type="button">Gmail (Web)</button>
      <button class="tabBtn" data-tab="gmail_mobile" type="button">Gmail (Mobile App)</button>
      <button class="tabBtn" data-tab="outlook_desktop" type="button">Outlook (Desktop)</button>
      <button class="tabBtn" data-tab="outlook_mobile" type="button">Outlook (Mobile App)</button>
    </div>

    <div id="help_general" class="helpPanel">
      <div class="importantBox">
        <b>IMPORTANT:</b> Delete any old signature everywhere you use your Rowe Casa Organics email before completing the steps below.
      </div>

      <h3>General</h3>
      <ul>
        <li><b>Build once:</b> Use this page to build your signature.</li>
        <li><b>Set everywhere:</b> Add it in every app you use (computer + phone).</li>
        <li><b>Gmail Mobile:</b> Do <b>not</b> paste a signature. Turn <b>Mobile Signature OFF</b> so the web signature is used.</li>
        <li><b>Copy/Paste tip:</b> Click inside the signature box, then paste (right-click ‚Üí Paste, or Ctrl/Cmd+V).</li>
        <li><b>Outlook note:</b> The signature can look different in the Outlook compose window. What matters is your <b>received</b> test email.</li>
        <li><b>Test procedure:</b> Send yourself a test email from <b>each</b> app you use. Confirm the signature looks correct in the received email.</li>
        <li><b>If something is off:</b> Delete the signature again, paste again, test again. If still wrong, email IT with screenshots.</li>
      </ul>

      <div class="divider"></div>

      <p style="margin:0; font-size:15px;">
        Contact IT: <a href="mailto:itsupport@rowecasaorganics.com" style="color:var(--brandRed); font-weight:900; text-decoration:none;">itsupport@rowecasaorganics.com</a>
      </p>
    </div>

    <div id="help_gmail_web" class="helpPanel" style="display:none;">
      <h3>Gmail (Web)</h3>
      <ul>
        <li>Open Gmail on your computer.</li>
        <li>Click <b>Settings</b> (gear) ‚Üí <b>See all settings</b>.</li>
        <li><b>Scroll down</b> to <b>Signature</b>.</li>
        <li>Delete old signatures for your Rowe Casa Organics account.</li>
        <li>Create a new signature ‚Üí paste using <b>Copy Signature</b>.</li>
        <li>Set defaults for <b>New emails</b> and <b>Replies/forwards</b>.</li>
        <li>Scroll down and click <b>Save Changes</b>.</li>
      </ul>
    </div>

    <div id="help_gmail_mobile" class="helpPanel" style="display:none;">
      <h3>Gmail (Mobile App)</h3>
      <ul>
        <li><b>You do not need to create or paste a signature</b> in the Gmail mobile app.</li>
        <li>Open Gmail ‚Üí Menu ‚Üí <b>Settings</b>.</li>
        <li>Tap your <b>Rowe Casa Organics</b> account.</li>
        <li>Open <b>Signature settings</b>.</li>
        <li>Turn <b>Mobile Signature OFF</b> / blank ‚Üí tap <b>Done</b>.</li>
      </ul>
    </div>

    <div id="help_outlook_desktop" class="helpPanel" style="display:none;">
      <h3>Outlook (Desktop)</h3>
      <ul>
        <li>Open Outlook and start a <b>New Email</b>.</li>
        <li>Click <b>Signature</b> ‚Üí <b>Signatures‚Ä¶</b> / <b>Manage Signatures</b>.</li>
        <li>Delete any old signature for your Rowe Casa Organics account.</li>
        <li>Create a new signature ‚Üí paste (right-click paste, or Ctrl/Cmd+V).</li>
        <li>Set it for <b>New messages</b> and <b>Replies/forwards</b> ‚Üí Save/OK.</li>
        <li>Send yourself a test email to confirm.</li>
      </ul>
    </div>

    <div id="help_outlook_mobile" class="helpPanel" style="display:none;">
      <h3>Outlook (Mobile App)</h3>
      <ul>
        <li>Open Outlook ‚Üí Settings.</li>
        <li>Open <b>Signature</b> (make sure you are on your Rowe Casa Organics account).</li>
        <li>Delete any old signature.</li>
        <li>Create a new signature ‚Üí paste using <b>Copy Signature</b>.</li>
        <li>Send yourself a test email to confirm.</li>
      </ul>
    </div>

    <div class="closeRow">
      <div class="hint" style="margin:0;">Press <span class="kbd">Esc</span> to close.</div>
      <button id="btnCloseHelp" type="button">Close</button>
    </div>
  </div>
</div>

<!-- IMAGE PREVIEW MODAL -->
<div class="modalBackdrop" id="imgBackdrop" role="dialog" aria-modal="true" aria-labelledby="imgTitle">
  <div class="imgModal">
    <div class="modalTopRow">
      <h2 id="imgTitle">Screenshot</h2>
      <button class="modalCloseTop" id="btnCloseImgTop" type="button">Close</button>
    </div>

    <div class="imgWrap">
      <img id="imgPreview" alt="Screenshot preview" />
    </div>

    <div class="closeRow">
      <div class="hint" style="margin:0;">Press <span class="kbd">Esc</span> to close.</div>
      <button id="btnCloseImg" type="button">Close</button>
    </div>
  </div>
</div>

<script>
  const BRAND = Object.freeze({
    version: "2025.5",
    approvedDomain: "rowecasaorganics.com",
    logoUrl: "https://www.rowecasaorganics.com/cdn/shop/files/Checkout_Logo.png",
    websiteText: "rowecasaorganics.com",
    websiteUrl: "https://rowecasaorganics.com",
    logoWidthPx: 96,
    leftColPadRightPx: 14,
    dividerPx: 1,
    dividerColor: "#000000",
    rightColPadLeftPx: 14,
    linkColor: "#1155cc"
  });

  const $ = (id) => document.getElementById(id);
  $("uiLogo").src = BRAND.logoUrl;

  function enc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;");
  }

  function isValidEmailCommon(v){
    const s = v.trim();
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s);
  }
  function hasApprovedDomain(v){
    const s = v.trim().toLowerCase();
    return s.endsWith("@" + BRAND.approvedDomain);
  }
  function containsLetters(s){ return /[A-Za-z]/.test(s || ""); }

  function groupDigits(digits, groups){
    let out = [];
    let idx = 0;
    for (const g of groups){
      if (idx >= digits.length) break;
      out.push(digits.slice(idx, idx+g));
      idx += g;
    }
    if (idx < digits.length) out.push(digits.slice(idx));
    return out.join(" ");
  }

  function formatPhone(raw){
    const original = (raw || "").trim();
    if (!original) return "";

    const hasPlus = original.startsWith("+");
    const digits = original.replace(/\D+/g, "");
    if (!digits) return original;

    if (hasPlus){
      const ccLen = Math.min(3, Math.max(1, digits.length - 7));
      const cc = digits.slice(0, ccLen);
      const rest = digits.slice(ccLen);
      const restGrouped = groupDigits(rest, [2,3,4,4]);
      return `+${cc} ${restGrouped}`.trim();
    }

    if (digits.length === 10){
      return `(${digits.slice(0,3)}) ${digits.slice(3,6)}-${digits.slice(6)}`;
    }
    if (digits.length === 11 && digits.startsWith("1")){
      const d = digits.slice(1);
      return `+1 (${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
    }
    if (digits.length === 7){
      return `${digits.slice(0,3)}-${digits.slice(3)}`;
    }
    return groupDigits(digits, [3,3,4,4]);
  }

  function normalizeExt(raw){
    const s = (raw || "").trim();
    if (!s) return "";
    const digitsOnly = s.replace(/\D+/g, "");
    return digitsOnly.slice(0, 4);
  }
  function isValidExt(raw){
    const s = (raw || "").trim();
    if (!s) return true;
    return /^\d{1,4}$/.test(s);
  }

  function getSelectedApps(){
    const map = [
      ["gmail_web", $("app_gmail_web")],
      ["outlook_desktop", $("app_outlook_desktop")],
      ["gmail_mobile", $("app_gmail_mobile")],
      ["outlook_mobile", $("app_outlook_mobile")]
    ];
    return map.filter(([k, el]) => el && el.checked).map(([k]) => k);
  }

  function getData(){
    return {
      apps: getSelectedApps(),
      fullName: $("fullName").value.trim(),
      jobTitle: $("jobTitle").value.trim(),
      email: $("email").value.trim(),
      cellRaw: $("cell").value,
      officeRaw: $("phone").value,
      extRaw: $("ext").value.trim()
    };
  }

  function validate(d){
    const issues = [];

    if (!d.apps.length){
      issues.push({ field:"apps", msg:"Select at least one app in Step 1." });
    }

    if (!d.fullName) issues.push({ field:"fullName", msg:"Full Name is required." });
    if (!d.jobTitle) issues.push({ field:"jobTitle", msg:"Job Title is required." });

    if (!d.email){
      issues.push({ field:"email", msg:"Work Email is required." });
    } else {
      if (!isValidEmailCommon(d.email)){
        issues.push({ field:"email", msg:"Work Email doesn‚Äôt look valid." });
      } else if (!hasApprovedDomain(d.email)){
        issues.push({ field:"email", msg:`Email must end with @${BRAND.approvedDomain}.` });
      }
    }

    if (!isValidExt(d.extRaw)){
      issues.push({ field:"ext", msg:"Office extension must be 1‚Äì4 digits (numbers only)." });
    }

    if (d.cellRaw && containsLetters(d.cellRaw)){
      issues.push({ field:"cell", msg:"Cell phone must not contain letters." });
    }
    if (d.officeRaw && containsLetters(d.officeRaw)){
      issues.push({ field:"phone", msg:"Office phone must not contain letters." });
    }

    return issues;
  }

  function clearValidationUI(){
    ["fullName","jobTitle","email","cell","phone","ext"].forEach(id => $(id).classList.remove("invalid"));
  }
  function applyValidationUI(issues){
    clearValidationUI();
    const marked = new Set();
    for (const it of issues){
      if (it.field && $(it.field) && !marked.has(it.field)){
        $(it.field).classList.add("invalid");
        marked.add(it.field);
      }
    }
  }

  function setStatus(html){ $("status").innerHTML = html; }

  function buildSignatureHtml(d){
    const cell = formatPhone(d.cellRaw);
    let office = formatPhone(d.officeRaw);
    const ext = normalizeExt(d.extRaw);
    if (office && ext) office += ` x ${ext}`;

    const phoneLines = [];
    if (cell)   phoneLines.push(`<div>C: ${enc(cell)}</div>`);
    if (office) phoneLines.push(`<div>O: ${enc(office)}</div>`);
    const phonesBlock = phoneLines.length ? ("\n        " + phoneLines.join("\n        ") + "\n") : "\n";

    return `<!-- =====================================================
     ROWE CASA ORGANICS EMAIL SIGNATURE
     Version: ${BRAND.version}
     ===================================================== -->
<div>--</div>
<table role="presentation" cellpadding="0" cellspacing="0" border="0" style="border-collapse:collapse; mso-table-lspace:0pt; mso-table-rspace:0pt;">
  <tr>
    <td style="padding:0 ${BRAND.leftColPadRightPx}px 0 0; vertical-align:middle; text-align:center;">
      <img src="${enc(BRAND.logoUrl)}"
           width="${BRAND.logoWidthPx}"
           alt="Rowe Casa Organics"
           style="display:block; margin:0 auto; border:0; outline:none; text-decoration:none;">
    </td>

    <td width="${BRAND.dividerPx}" bgcolor="${BRAND.dividerColor}"
        style="width:${BRAND.dividerPx}px; background-color:${BRAND.dividerColor}; font-size:0; line-height:0;">
      &nbsp;
    </td>

    <td style="padding:0 0 0 ${BRAND.rightColPadLeftPx}px; vertical-align:top;">
      <div style="
        font-family:'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size:11pt;
        line-height:1.25;
        mso-line-height-rule:exactly;
        color:#000000;
      ">
        <div style="font-weight:700;">${enc(d.fullName)}</div>
        <div style="font-weight:400;">${enc(d.jobTitle)}</div>

        <div style="height:8px; line-height:8px; font-size:8px;">&nbsp;</div>

        <div>
          <a href="mailto:${enc(d.email)}" style="color:${BRAND.linkColor}; text-decoration:none;">${enc(d.email)}</a>
        </div>${phonesBlock}
        <div>
          <a href="${enc(BRAND.websiteUrl)}" style="color:${BRAND.linkColor}; text-decoration:none;">${enc(BRAND.websiteText)}</a>
        </div>
      </div>
    </td>
  </tr>
</table>`;
  }

  function buildPlainText(d){
    const cell = formatPhone(d.cellRaw);
    let office = formatPhone(d.officeRaw);
    const ext = normalizeExt(d.extRaw);
    if (office && ext) office += ` x ${ext}`;

    const lines = [];
    lines.push("--");
    lines.push("");
    lines.push(`ROWE CASA ORGANICS | ${d.fullName}`);
    lines.push(`                 | ${d.jobTitle}`);
    lines.push(`                 | ${d.email}`);
    if (cell)   lines.push(`                 | C: ${cell}`);
    if (office) lines.push(`                 | O: ${office}`);
    lines.push(`                 | ${BRAND.websiteText}`);
    return lines.join("\n");
  }

  function stripToText(html){
    const tmp = document.createElement("div");
    tmp.innerHTML = html;
    tmp.querySelectorAll("br").forEach(br => br.replaceWith("\n"));
    tmp.querySelectorAll("div, p, tr, td").forEach(el => {
      if (!el.textContent.endsWith("\n")) el.appendChild(document.createTextNode("\n"));
    });
    return tmp.textContent.replace(/\n{3,}/g, "\n\n").trim();
  }

  function flashBtn(btnId){
    const btn = $(btnId);
    if(!btn) return;
    btn.classList.add("copied");
    const orig = btn.innerText;
    btn.innerText = "Copied!";
    setTimeout(() => {
      btn.classList.remove("copied");
      btn.innerText = orig;
    }, 1100);
  }

  async function copySignatureHtml(html, btnId){
    try{
      if (window.ClipboardItem && navigator.clipboard?.write){
        const htmlBlob = new Blob([html], { type: "text/html" });
        const textBlob = new Blob([stripToText(html)], { type: "text/plain" });
        await navigator.clipboard.write([ new ClipboardItem({ "text/html": htmlBlob, "text/plain": textBlob }) ]);
        flashBtn(btnId);
        return true;
      }
    } catch(_) {}

    try{
      if (navigator.clipboard?.writeText){
        await navigator.clipboard.writeText(stripToText(html));
        flashBtn(btnId);
        return true;
      }
    } catch(_) {}

    return false;
  }

  async function copyTextareaWithFeedback(textareaEl, btnId){
    try{
      if (navigator.clipboard?.writeText){
        await navigator.clipboard.writeText(textareaEl.value);
        flashBtn(btnId);
        return true;
      }
    } catch(_) {}

    textareaEl.focus();
    textareaEl.select();
    textareaEl.setSelectionRange(0, textareaEl.value.length);
    return false;
  }

  function downloadFile(filename, text){
    const blob = new Blob([text], { type: "text/html;charset=utf-8" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(a.href), 500);
  }

  function shotsAccordion(images, caption){
    if (!images || !images.length) return "";
    const thumbs = images.map((src, i) => {
      const title = `${caption} screenshot ${i+1}`;
      return `
        <div class="shotThumb" data-img="${src}" data-title="${title}">
          <img src="${src}" alt="${title}" loading="lazy" />
          <div class="shotCap">${title} (tap to zoom)</div>
        </div>
      `;
    }).join("");

    return `
      <details class="shots">
        <summary class="shotsSum">
          <span class="shotsTitle"><span class="shotIcon">üì∏</span> Show screenshots (tap to expand)</span>
          <span class="shotCaret" aria-hidden="true">^</span>
        </summary>
        <div class="shotsBody">
          <div class="shotGrid">
            ${thumbs}
          </div>
          <div class="hint" style="margin-top:10px;">
            If your screen looks a little different, that‚Äôs okay ‚Äî follow the same idea and look for ‚ÄúSignature‚Äù.
          </div>
        </div>
      </details>
    `;
  }

  function renderStep3(apps){
    const wrap = $("instWrap");
    if (!apps.length){
      wrap.innerHTML = `
        <div class="instCard">
          <div class="instHead">
            <div class="instNum">1</div>
            <div>
              <h3>Select your apps in Step 1</h3>
              <p>Then click <b>Build Signature</b>.</p>
            </div>
          </div>
        </div>
      `;
      return;
    }

    let n = 0;
    const cards = [];

    function card(title, lead, items, shotsHtml){
      n += 1;
      return `
        <div class="instCard">
          <div class="instHead">
            <div class="instNum">${n}</div>
            <div style="flex:1;">
              <h3>${title}</h3>
              <p>${lead}</p>
            </div>
          </div>

          <ul>
            ${items.map(x => `<li>${x}</li>`).join("")}
          </ul>

          ${shotsHtml || ""}
        </div>
      `;
    }

    if (apps.includes("gmail_web")){
      cards.push(card(
        "Gmail (Web)",
        "Set your signature in Gmail on your computer.",
        [
          `Open Gmail on your computer.`,
          `Settings (gear) ‚Üí <b>See all settings</b>.`,
          `<b>Scroll down</b> to <b>Signature</b>.`,
          `Delete any old signature for your Rowe Casa Organics account.`,
          `Create a new signature ‚Üí paste using <b>Copy Signature</b>.`,
          `Set defaults for <b>New emails</b> and <b>Replies/forwards</b>.`,
          `Scroll down and click <b>Save Changes</b>.`,
          `Send yourself a test email to confirm.`
        ],
        shotsAccordion(["screenshots/Gmail-Web-1.png","screenshots/Gmail-Web-2.png"], "Gmail Web")
      ));
    }

    if (apps.includes("outlook_desktop")){
      cards.push(card(
        "Outlook (Desktop)",
        "Set your signature in Outlook on your computer.",
        [
          `Open Outlook and start a <b>New Email</b>.`,
          `Click <b>Signature</b> ‚Üí <b>Signatures‚Ä¶</b> / <b>Manage Signatures</b>.`,
          `Delete any old signature for your Rowe Casa Organics account.`,
          `Create a new signature ‚Üí paste (right-click paste, or Ctrl/Cmd+V).`,
          `Set it for <b>New messages</b> and <b>Replies/forwards</b> ‚Üí Save/OK.`,
          `Send yourself a test email to confirm.`
        ],
        shotsAccordion(["screenshots/Outlook-Win-1.png","screenshots/Outlook-Win-2.png","screenshots/Outlook-Mac-1.png","screenshots/Outlook-Mac-2.png"], "Outlook Desktop")
      ));
    }

    if (apps.includes("gmail_mobile")){
      cards.push(card(
        "Gmail (Mobile App)",
        "You do NOT paste a signature here. Turn Mobile Signature OFF so the web signature is used.",
        [
          `Open the Gmail app.`,
          `Open Menu ‚Üí <b>Settings</b>.`,
          `Tap your <b>Rowe Casa Organics</b> account.`,
          `Open <b>Signature settings</b>.`,
          `Turn <b>Mobile Signature</b> OFF / blank ‚Üí tap <b>Done</b>.`,
          `Send yourself a test email from the app to confirm.`
        ],
        shotsAccordion(["screenshots/Gmail-App-1.png","screenshots/Gmail-App-2.png","screenshots/Gmail-App-3.png","screenshots/Gmail-App-4.png"], "Gmail App")
      ));
    }

    if (apps.includes("outlook_mobile")){
      cards.push(card(
        "Outlook (Mobile App)",
        "Paste your signature in Outlook mobile, then test.",
        [
          `Open Outlook ‚Üí Settings.`,
          `Open <b>Signature</b> (make sure you are on your Rowe Casa Organics account).`,
          `Delete any old signature.`,
          `Create a new signature ‚Üí paste using <b>Copy Signature</b>.`,
          `Send yourself a test email to confirm.`
        ],
        shotsAccordion(["screenshots/Outlook-App-1.png","screenshots/Outlook-App-2.png","screenshots/Outlook-App-3.png","screenshots/Outlook-App-4.png"], "Outlook App")
      ));
    }

    wrap.innerHTML = cards.join("");
  }

  function render(showStatus=true){
    $("ext").value = normalizeExt($("ext").value);

    const d = getData();
    const issues = validate(d);

    renderStep3(d.apps);

    if (issues.length){
      applyValidationUI(issues);
      $("previewArea").innerHTML = `<div class="hint"><b>Click Build Signature</b> to create your signature.</div>`;
      $("btnCopySignature").disabled = true;

      if ($("btnCopyText")) $("btnCopyText").disabled = true;
      if ($("btnCopyHtml")) $("btnCopyHtml").disabled = true;
      if ($("btnSave")) $("btnSave").disabled = true;

      if ($("htmlOut")) $("htmlOut").value = "";
      if ($("plainOut")) $("plainOut").value = "";

      if (showStatus){
        setStatus(`<span class="err">Fix these items:</span><br>‚Ä¢ ${issues.map(x=>x.msg).join("<br>‚Ä¢ ")}`);
      }
      return null;
    }

    clearValidationUI();

    const html = buildSignatureHtml(d);
    const txt  = buildPlainText(d);

    $("previewArea").innerHTML = html;
    $("btnCopySignature").disabled = false;

    if ($("htmlOut")) $("htmlOut").value = html;
    if ($("plainOut")) $("plainOut").value = txt;

    if ($("btnCopyText")) $("btnCopyText").disabled = false;
    if ($("btnCopyHtml")) $("btnCopyHtml").disabled = false;
    if ($("btnSave")) $("btnSave").disabled = false;

    if (showStatus){
      setStatus(`<span class="ok">Signature built.</span> Click <b>Copy Signature</b>.`);
    }
    return { html, txt };
  }

  function resetAll(){
    ["app_gmail_web","app_outlook_desktop","app_gmail_mobile","app_outlook_mobile"].forEach(id => $(id).checked = false);
    ["fullName","jobTitle","email","cell","phone","ext"].forEach(id => $(id).value = "");
    clearValidationUI();

    $("previewArea").innerHTML = `<div class="hint">Click <b>Build Signature</b> to create your signature.</div>`;
    $("btnCopySignature").disabled = true;

    if ($("htmlOut")) $("htmlOut").value = "";
    if ($("plainOut")) $("plainOut").value = "";

    if ($("btnCopyText")) $("btnCopyText").disabled = true;
    if ($("btnCopyHtml")) $("btnCopyHtml").disabled = true;
    if ($("btnSave")) $("btnSave").disabled = true;

    renderStep3([]);
    setStatus(`Choose your apps, enter your details, then click <b>Build Signature</b>.`);
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function openAdmin(){
    const pwd = prompt("Admin password:");
    if (pwd === null) return;
    if (pwd === "password"){
      $("adminPanel").classList.add("show");
      setStatus(`<span class="ok">Admin unlocked.</span>`);
    } else {
      alert("Incorrect password.");
    }
  }

  // Help modal tabs
  function showHelpTab(tab){
    document.querySelectorAll(".tabBtn").forEach(b => b.classList.toggle("active", b.dataset.tab === tab));
    ["general","gmail_web","gmail_mobile","outlook_desktop","outlook_mobile"].forEach(k => {
      const el = $("help_" + k);
      if (el) el.style.display = (k === tab) ? "block" : "none";
    });
  }

  // Modals
  const helpBackdrop = $("helpBackdrop");
  function openHelp(){
    showHelpTab("general"); // default
    helpBackdrop.style.display = "flex";
  }
  function closeHelp(){ helpBackdrop.style.display = "none"; }

  const imgBackdrop = $("imgBackdrop");
  function openImg(title, src){
    $("imgTitle").textContent = title || "Screenshot";
    $("imgPreview").src = src;
    imgBackdrop.style.display = "flex";
  }
  function closeImg(){
    imgBackdrop.style.display = "none";
    $("imgPreview").src = "";
  }

  // Events
  ["app_gmail_web","app_outlook_desktop","app_gmail_mobile","app_outlook_mobile"].forEach(id => {
    $(id).addEventListener("change", () => renderStep3(getSelectedApps()));
  });

  $("btnReset").addEventListener("click", resetAll);
  $("btnGenerate").addEventListener("click", () => render(true));

  $("btnCopySignature").addEventListener("click", async () => {
    const out = render(false);
    if (!out) return;
    const ok = await copySignatureHtml(out.html, "btnCopySignature");
    setStatus(ok ? `<span class="ok">Copied!</span> Paste into your signature settings, then send a test email.`
                 : `<span class="warn">Copy may be blocked.</span> Contact IT with screenshots.`);
  });

  $("btnAdminTop").addEventListener("click", openAdmin);

  document.addEventListener("click", async (e) => {
    // Admin buttons
    if (e.target && e.target.id === "btnCopyText"){
      const out = render(false);
      if (!out) return;
      const ok = await copyTextareaWithFeedback($("plainOut"), "btnCopyText");
      setStatus(ok ? `<span class="ok">Copied!</span> (Plain Text)` : `<span class="warn">Copy may be blocked.</span> The text is selected‚Äîcopy it manually.`);
    }
    if (e.target && e.target.id === "btnCopyHtml"){
      const out = render(false);
      if (!out) return;
      const ok = await copyTextareaWithFeedback($("htmlOut"), "btnCopyHtml");
      setStatus(ok ? `<span class="ok">Copied!</span> (HTML)` : `<span class="warn">Copy may be blocked.</span> The HTML is selected‚Äîcopy it manually.`);
    }
    if (e.target && e.target.id === "btnSave"){
      const out = render(false);
      if (!out) return;
      const safeName = ($("fullName").value || "Signature").replace(/[\\/:*?"<>|]+/g, "").trim();
      downloadFile(`Rowe Casa Organics - Signature - ${safeName}.html`, out.html);
      setStatus(`<span class="ok">Saved!</span> File downloaded.`);
    }

    // Screenshot thumbnail click -> image preview modal
    const thumb = e.target.closest?.(".shotThumb");
    if (thumb){
      const src = thumb.getAttribute("data-img");
      const title = thumb.getAttribute("data-title") || "Screenshot";
      if (src) openImg(title, src);
    }
  });

  $("cell").addEventListener("blur", () => { $("cell").value = formatPhone($("cell").value); });
  $("phone").addEventListener("blur", () => { $("phone").value = formatPhone($("phone").value); });
  $("ext").addEventListener("blur", () => { $("ext").value = normalizeExt($("ext").value); });

  // Help modal controls (top + bottom)
  $("btnHelpTop").addEventListener("click", openHelp);
  $("btnCloseHelp").addEventListener("click", closeHelp);
  $("btnCloseHelpTop").addEventListener("click", closeHelp);
  helpBackdrop.addEventListener("click", (e) => { if (e.target === helpBackdrop) closeHelp(); });

  document.querySelectorAll(".tabBtn").forEach(btn => {
    btn.addEventListener("click", () => showHelpTab(btn.dataset.tab));
  });

  // Image modal controls (top + bottom)
  $("btnCloseImg").addEventListener("click", closeImg);
  $("btnCloseImgTop").addEventListener("click", closeImg);
  imgBackdrop.addEventListener("click", (e) => { if (e.target === imgBackdrop) closeImg(); });

  // Esc closes whichever modal is open
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape"){
      if (imgBackdrop.style.display === "flex") closeImg();
      else closeHelp();
    }
  });

  // Init
  $("previewArea").innerHTML = `<div class="hint">Click <b>Build Signature</b> to create your signature.</div>`;
  renderStep3([]);
  setStatus(`Choose your apps, enter your details, then click <b>Build Signature</b>.`);
</script>
</body>
</html>